--1
SELECT M.FIRST_NAME, M.LAST_NAME, COUNT (1) AS CNT
FROM EMPLOYEES E JOIN EMPLOYEES M ON E.MANAGER_ID = M.EMPLOYEE_ID
GROUP BY M.FIRST_NAME, M.LAST_NAME
HAVING COUNT (1) > 6

--2
SELECT DEPARTMENT_NAME, MIN_SALARY, MAX_SALARY
FROM 
(
SELECT DEPARTMENT_NAME, MAX(SALARY-SALARY *(COMMISSION_PCT/100)) as MAX_SALARY
			MIN (SALARY-SALARY *(COMMISSION_PCT/100)) as MIN_SALARY
FROM DEPARTMENTS D RIGHT JOIN EMPLOYEES E 
			ON D.DEPARTMENTS_ID=E.DEPARTMENTS_ID
) T
GROUP BY DEPARTMENT_NAME

--3
SELECT TOP 1 WITH TIES REGION_NAME
FROM
(
SELECT REGION_NAME, COUNT(EMPLOYEE_ID) AS CNT_EMP
FROM EMPLOYEES E JOIN DEPARTMENTS D ON E.DEPARTMENT_ID=D.DEPARTMENT_ID
		JOIN LOCATIONS L ON D.LOCATION_ID=L.LOCATION_ID
		JOIN COUNTRIES C ON L.COUNTRY_ID=C.COUNTRY_ID
		JOIN REGIONS R ON C.REGION_ID=R.REGION_ID
GROUP BY REGION_NAME
) REG
ORDER BY CNT_EMP

--4
SELECT DEPARTMENT_NAME, (AVG_SALARY/AVG_SALARY_DEPARTMENT-1)*100 AS DIFFERENCE_AVG
(
SELECT DEPARTMENT_NAME, AVG(SALARY) OVER () AS AVG_SALARY,
			AVG(SALARY) OVER (PARTITION BY DEPARTMENT_NAME) AS AVG_SALARY_DEPARTMENT
FROM EMPLOYEES E JOIN DEPARTMENTS D 
		ON E.DEPARTMENTS_ID=D.DEPARTMENTS_ID
)T

--5
SELECT FIRST_NAME, LAST_NAME, DEPARTMENT_NAME, DATEDIFF(YEAR,END_DATE,START_DATE) AS DAT
FROM EMPLOYEES E JOIN JOB_HISTORY J ON E.EMPLOYEE_ID=J.EMPLOYEE_ID
		JOIN DEPARTMENTS D ON E.DEPARTMENT_ID=D.DEPARTMENT_ID
WHERE DATEDIFF(YEAR,END_DATE,START_DATE)>10

--6
SELECT FIRST_NAME, LAST_NAME, RANK_SALARY
FROM
(
SELECT FIRST_NAME, LAST_NAME, RANK () OVER (ORDER BY SALARY DESC) AS RANK_SALARY
FROM EMPLOYEES
) RANK
WHERE RANK_SALARY BETWEEN 5 AND 10
